# EVE Commissar

[![en](https://img.shields.io/badge/lang-en-red.svg)](https://github.com/AnaxRho/EVECommissar/blob/main/README.md)
[![ru](https://img.shields.io/badge/lang-ru-yellow.svg)](https://github.com/AnaxRho/EVECommissar/blob/main/README.ru.md)

EVE Commissar — это Discord бот и веб приложение с открытым исходным кодом для управления ролями на сервере Discord на основании нахождения персонажей пользователя в корпорации EVE Online.

[Bot invite link](https://discord.com/api/oauth2/authorize?client_id=1157665492564197437&permissions=268437504&scope=bot)

## Содержание

* [Руководство администратора](#руководство-администратора)
* [Руководство пользователя](#руководство-пользователя)

## Руководство администратора
    
### Предусловия

* Создайте и настройте на сервере Discord роли, которые EVE Commissar должен выдавать.
* Роль EVECommissar в списке ролей сервера должна быть выше ролей, которые бот должен выдавать \ отзывать.
* На сервере должен быть текстовый канал для уведомлений о выдаче \ отзыве ролей ботом.
* Для создания автоматических правил вам понадобится внутриигровой ID корпорации, который может быть легко получен на zKillboard или Dotlan.

### Настройка уведомлений

Настройте уведомления с помощью команды `/setup`.

Команда принимает 2 аргумента:
* `channel` — канал для уведомлений. Нажмите `#` в поле для вызова списка каналов;
* `locale` — название локали (языка) для уведомлений бота. На данный момент доступны опции `ru`, `en` (по умолчанию).

### Создание правил

После выполнения предусловий можно создать правило с помощью команды `/rules add`.

Команда принимает 2 аргумента:
* `corporation_id` — ID корпорации в EVE Online. ;
* `role` — роль, которая должна назначаться ботом. Нажмите `@` в поле для вызова списка ролей.
    
После создания правила EVE Commissar может выполнять автоматизированные задачи по выдаче \ отзыву ролей.

Используйте команду `/rules show` для просмотра списка правил.\
Используйте команду `/rules remove` для удаления правила.
    
### Управление пользователями

* `/member info` для проверки зарегистрированных пользователем персонажей.
* `/member register` может быть использована для самостоятельной регистрации персонажа другого пользователя при условии, что ты знаешь ID персонажа.

### Отчеты

* `/reports stats` — просмотр статистики регистрации пользователей.
* `/reports unregistered` — вывод списка пользователей, которые еще не зарегистрировали ни одного персонажа.
* `/reports registered` — просмотр статистики зарегистрированных пользователей и персонажей.

### Автоматизированные задачи

* EVE Commissar обновляет информацию о зарегистрированных персонажах каждые 4 часа.
* EVE Commissar проверяет необходимость выдачи роли каждые 5 минут.
  * Для выдачи роли у пользователя должен быть хотя бы один зарегистрированный персонаж в указанной корпорации.
  * Для отзыва роли у пользователя не должно быть зарегистрированного персонажа в указанной корпорации.

### Соображения безопасности
       
* EVECommissar — приложение с открытым исходным кодом.
* В процессе авторизации персонажей EVECommissar запрашивает авторизационную информацию OAuth 2.0 от `login.eveonline.com`, используя только область применения (scope) 'publicData'.
* EVECommissar не хранит авторизационную информацию (access_token, refresh_token).
* Ключ доступа (access_token) используется только один раз для подтверждения ID персонажа.

Обращайтесь к [sso_authorization_flow](`https://docs.esi.evetech.net/docs/sso/sso_authorization_flow.html`) для получения дополнительной информации об OAuth 2.0

## Руководство пользователя
    
* Начните с выполнения команды `/character register` для регистрации своего первого персонажа EVE Online с помощью бота. Далее следуйте инструкциям в личном сообщении.
* Команда `/character info` может быть использована для просмотра своих зарегистрированных персонажей. 
* Команда `/character remove` — для удаления.  
